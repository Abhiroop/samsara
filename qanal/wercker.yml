box: wercker/default
#services:
#  - wercker/postgresql
#  - wercker/rabbitmq
#  - wercker/redis
build:
  steps:
    - script:
        name: install clojure
        code: |
          sudo apt-get update
          sudo apt-get install openjdk-7-jdk curl -y
          sudo wget -O /usr/local/bin/lein https://raw.github.com/technomancy/leiningen/stable/bin/lein
          sudo chmod +x /usr/local/bin/lein
    - script:
        name: run tests
        code: |
          lein midje
    - script:
        name: build
        code: |
          lein uberjar
    - script:
        name: install latest docker
        code: curl -sSL https://get.docker.io/ubuntu/ | sudo sh
    - script:
        name: build docker image
        code: sudo docker build -t samsara/qanal:snapshot .
    - script:
        name: login to docker hub
        code: sudo docker login -u $DOCKER_USER -p $DOCKER_PASSWORD -e $DOCKER_EMAIL
    - script:
        name: push docker image
        code: sudo docker push samsara/qanal:snapshot